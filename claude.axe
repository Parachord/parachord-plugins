{
  "manifest": {
    "id": "claude",
    "name": "Claude",
    "type": "meta-service",
    "version": "1.0.0",
    "icon": "ðŸ§¡",
    "color": "#D97757",
    "author": "Parachord Team",
    "description": "Anthropic's Claude - thoughtful and capable AI assistant.",
    "homepage": "https://anthropic.com"
  },
  "capabilities": {
    "chat": true
  },
  "settings": {
    "requiresAuth": true,
    "authType": "apikey",
    "configurable": {
      "apiKey": {
        "type": "password",
        "label": "API Key",
        "description": "Your Anthropic API key",
        "placeholder": "sk-ant-..."
      },
      "model": {
        "type": "select",
        "label": "Model",
        "description": "The Claude model to use",
        "options": [
          { "value": "claude-sonnet-4-20250514", "label": "Claude Sonnet 4 (Recommended)" },
          { "value": "claude-3-5-sonnet-20241022", "label": "Claude 3.5 Sonnet" },
          { "value": "claude-3-5-haiku-20241022", "label": "Claude 3.5 Haiku (Fast)" }
        ],
        "default": "claude-sonnet-4-20250514"
      }
    }
  },
  "implementation": {
    "chat": "async function(messages, tools, config) {\n  if (!config.apiKey) {\n    throw new Error('API key is required');\n  }\n\n  const model = config.model || 'claude-sonnet-4-20250514';\n\n  // Convert messages to Claude format\n  // Claude uses 'user' and 'assistant' roles, system goes separately\n  let systemPrompt = '';\n  const claudeMessages = [];\n\n  for (const msg of messages) {\n    if (msg.role === 'system') {\n      systemPrompt = msg.content;\n    } else if (msg.role === 'user') {\n      claudeMessages.push({ role: 'user', content: msg.content });\n    } else if (msg.role === 'assistant') {\n      // Handle assistant messages with tool calls\n      if (msg.tool_calls && msg.tool_calls.length > 0) {\n        const content = [];\n        if (msg.content) {\n          content.push({ type: 'text', text: msg.content });\n        }\n        for (const tc of msg.tool_calls) {\n          content.push({\n            type: 'tool_use',\n            id: tc.id || tc.name,\n            name: tc.name,\n            input: tc.arguments\n          });\n        }\n        claudeMessages.push({ role: 'assistant', content });\n      } else {\n        claudeMessages.push({ role: 'assistant', content: msg.content });\n      }\n    } else if (msg.role === 'tool') {\n      // Tool results go as user messages with tool_result content\n      claudeMessages.push({\n        role: 'user',\n        content: [{\n          type: 'tool_result',\n          tool_use_id: msg.tool_call_id,\n          content: msg.content\n        }]\n      });\n    }\n  }\n\n  // Convert tools to Claude format\n  const claudeTools = tools && tools.length > 0 ? tools.map(t => ({\n    name: t.name,\n    description: t.description,\n    input_schema: t.parameters\n  })) : undefined;\n\n  // Build request\n  const body = {\n    model: model,\n    max_tokens: 1024,\n    messages: claudeMessages\n  };\n\n  if (systemPrompt) {\n    body.system = systemPrompt;\n  }\n\n  if (claudeTools && claudeTools.length > 0) {\n    body.tools = claudeTools;\n  }\n\n  const response = await fetch('https://api.anthropic.com/v1/messages', {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      'x-api-key': config.apiKey,\n      'anthropic-version': '2023-06-01'\n    },\n    body: JSON.stringify(body)\n  });\n\n  if (!response.ok) {\n    const text = await response.text();\n    // Parse error response for user-friendly message\n    try {\n      const errorData = JSON.parse(text);\n      const errorMsg = errorData.error?.message || errorData.message || text;\n      const errorType = errorData.error?.type || '';\n      \n      // Map common errors to friendly messages\n      if (errorType === 'authentication_error' || errorMsg.includes('invalid x-api-key')) {\n        throw new Error('Invalid API key. Please check your Claude API key in settings.');\n      }\n      if (errorType === 'invalid_request_error' && errorMsg.includes('credit')) {\n        throw new Error('No API credits remaining. Please add credits to your Anthropic account.');\n      }\n      if (response.status === 429) {\n        throw new Error('Rate limit reached. Please wait a moment and try again.');\n      }\n      if (response.status === 529 || errorMsg.includes('overloaded')) {\n        throw new Error('Claude is currently overloaded. Please try again in a few moments.');\n      }\n      throw new Error(errorMsg);\n    } catch (parseErr) {\n      if (parseErr.message && !parseErr.message.includes('JSON')) {\n        throw parseErr;\n      }\n      throw new Error(`Claude API error (${response.status})`);\n    }\n  }\n\n  const data = await response.json();\n\n  // Parse response\n  let content = '';\n  let toolCalls = null;\n\n  if (data.content && Array.isArray(data.content)) {\n    for (const block of data.content) {\n      if (block.type === 'text') {\n        content += block.text;\n      } else if (block.type === 'tool_use') {\n        if (!toolCalls) toolCalls = [];\n        toolCalls.push({\n          id: block.id,\n          name: block.name,\n          arguments: block.input\n        });\n      }\n    }\n  }\n\n  return {\n    content: content,\n    toolCalls: toolCalls\n  };\n}"
  }
}
