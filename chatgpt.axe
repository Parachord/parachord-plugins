{
  "manifest": {
    "id": "chatgpt",
    "name": "ChatGPT",
    "type": "meta-service",
    "version": "1.0.0",
    "author": "Parachord Team",
    "description": "Generate playlists using ChatGPT. Requires your own API key.",
    "icon": "ðŸ¤–",
    "color": "#10a37f",
    "homepage": "https://platform.openai.com"
  },

  "capabilities": {
    "generate": true
  },

  "settings": {
    "requiresAuth": true,
    "authType": "apiKey",
    "configurable": {
      "apiKey": {
        "type": "password",
        "label": "API Key",
        "placeholder": "sk-...",
        "helpUrl": "https://platform.openai.com/api-keys"
      },
      "model": {
        "type": "select",
        "label": "Model",
        "default": "gpt-4o-mini",
        "options": [
          { "value": "gpt-4o-mini", "label": "GPT-4o Mini (Recommended)" },
          { "value": "gpt-4o", "label": "GPT-4o" },
          { "value": "gpt-3.5-turbo", "label": "GPT-3.5 Turbo" }
        ]
      }
    }
  },

  "implementation": {
    "generate": "async function(prompt, config, listeningContext) { if (!config.apiKey) { throw new Error('API key required. Add your OpenAI API key in Settings â†’ General â†’ AI Integration.'); } try { let systemPrompt = 'You are a music recommendation assistant. Given a prompt and optionally the user\\'s listening history, return a JSON object with a \"tracks\" array containing 10-15 track recommendations. Each track must have \"artist\" and \"title\" fields. When listening history is provided, use it to understand the user\\'s taste but don\\'t just recommend what they already listen to. Find tracks that complement their taste while honoring the prompt. Prioritize discovery over familiarity. Only return valid JSON, no explanation or markdown.'; let userPrompt = prompt; if (listeningContext) { userPrompt = `My listening history (${listeningContext.window}):\\n\\nTop Artists: ${listeningContext.top_artists.join(', ')}\\n\\nTop Tracks:\\n${listeningContext.top_tracks.map(t => `- ${t.artist} - ${t.title}`).join('\\n')}\\n\\n---\\n\\nRequest: ${prompt}`; } const response = await fetch('https://api.openai.com/v1/chat/completions', { method: 'POST', headers: { 'Authorization': 'Bearer ' + config.apiKey, 'Content-Type': 'application/json' }, body: JSON.stringify({ model: config.model || 'gpt-4o-mini', messages: [{ role: 'system', content: systemPrompt }, { role: 'user', content: userPrompt }], response_format: { type: 'json_object' } }) }); if (!response.ok) { const error = await response.json().catch(() => ({})); if (response.status === 401) { throw new Error('Invalid API key. Check your OpenAI API key in Settings.'); } if (response.status === 403) { throw new Error('API access denied. You may need to enable billing at platform.openai.com.'); } if (response.status === 429) { throw new Error('Rate limit exceeded. OpenAI\\'s API is pay-as-you-go after trial credits expire. Please wait and try again, or check your billing at platform.openai.com.'); } if (response.status >= 500) { throw new Error('AI service temporarily unavailable. Try again later.'); } throw new Error(error.error?.message || 'OpenAI API request failed'); } const data = await response.json(); const content = data.choices[0]?.message?.content; if (!content) { throw new Error('No response from OpenAI'); } const parsed = JSON.parse(content); const tracks = parsed.tracks || parsed.playlist || parsed.songs || []; if (!Array.isArray(tracks) || tracks.length === 0) { throw new Error('AI returned no tracks. Try a different prompt.'); } return tracks.map(t => ({ artist: t.artist || t.Artist || '', title: t.title || t.track || t.song || t.Title || '' })).filter(t => t.artist && t.title); } catch (error) { if (error.message.includes('API key') || error.message.includes('Rate limit') || error.message.includes('No response') || error.message.includes('no tracks') || error.message.includes('access denied') || error.message.includes('billing') || error.message.includes('unavailable')) { throw error; } console.error('OpenAI generate error:', error); throw new Error('Failed to generate playlist: ' + error.message); } }",

    "init": "async function(config) { console.log('OpenAI plugin initialized'); }",

    "cleanup": "async function() { console.log('OpenAI plugin cleanup'); }"
  }
}
